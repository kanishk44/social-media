{
  "info": {
    "name": "Social Media Backend API",
    "description": "Complete API collection for testing the social media backend with authentication, posts, follows, and media uploads.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:4000/api/v1",
      "type": "string"
    },
    {
      "key": "access_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "user_id",
      "value": "",
      "type": "string"
    },
    {
      "key": "upload_url",
      "value": "",
      "type": "string"
    },
    {
      "key": "media_url",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Auth",
      "item": [
        {
          "name": "Register",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('access_token', response.data.accessToken);",
                  "    pm.collectionVariables.set('user_id', response.data.user.id);",
                  "    pm.test('Registration successful', function () {",
                  "        pm.expect(response.success).to.be.true;",
                  "        pm.expect(response.data.accessToken).to.be.a('string');",
                  "    });",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"newuser@example.com\",\n  \"handle\": \"newuser\",\n  \"name\": \"New User\",\n  \"password\": \"password123\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/register",
              "host": ["{{base_url}}"],
              "path": ["auth", "register"]
            },
            "description": "Register a new user account"
          }
        },
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('access_token', response.data.accessToken);",
                  "    pm.collectionVariables.set('user_id', response.data.user.id);",
                  "    pm.test('Login successful', function () {",
                  "        pm.expect(response.success).to.be.true;",
                  "        pm.expect(response.data.accessToken).to.be.a('string');",
                  "    });",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"emailOrHandle\": \"alice@example.com\",\n  \"password\": \"password123\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/login",
              "host": ["{{base_url}}"],
              "path": ["auth", "login"]
            },
            "description": "Login with email/handle and password. Token is automatically saved for subsequent requests."
          }
        }
      ],
      "description": "Authentication endpoints for user registration and login"
    },
    {
      "name": "Users",
      "item": [
        {
          "name": "Get User Profile",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/users/:id",
              "host": ["{{base_url}}"],
              "path": ["users", ":id"],
              "variable": [
                {
                  "key": "id",
                  "value": "{{user_id}}",
                  "description": "User ID to fetch"
                }
              ]
            },
            "description": "Get public profile information for any user"
          }
        },
        {
          "name": "Follow User",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/users/:id/follow",
              "host": ["{{base_url}}"],
              "path": ["users", ":id", "follow"],
              "variable": [
                {
                  "key": "id",
                  "value": "",
                  "description": "ID of user to follow"
                }
              ]
            },
            "description": "Follow another user (authentication required)"
          }
        },
        {
          "name": "Unfollow User",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/users/:id/follow",
              "host": ["{{base_url}}"],
              "path": ["users", ":id", "follow"],
              "variable": [
                {
                  "key": "id",
                  "value": "",
                  "description": "ID of user to unfollow"
                }
              ]
            },
            "description": "Unfollow a user (authentication required)"
          }
        },
        {
          "name": "Get Followers",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/users/:id/followers?offset=0&limit=20",
              "host": ["{{base_url}}"],
              "path": ["users", ":id", "followers"],
              "query": [
                {
                  "key": "offset",
                  "value": "0",
                  "description": "Pagination offset"
                },
                {
                  "key": "limit",
                  "value": "20",
                  "description": "Number of items (max 100)"
                }
              ],
              "variable": [
                {
                  "key": "id",
                  "value": "{{user_id}}",
                  "description": "User ID"
                }
              ]
            },
            "description": "Get paginated list of user's followers"
          }
        },
        {
          "name": "Get Following",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/users/:id/following?offset=0&limit=20",
              "host": ["{{base_url}}"],
              "path": ["users", ":id", "following"],
              "query": [
                {
                  "key": "offset",
                  "value": "0",
                  "description": "Pagination offset"
                },
                {
                  "key": "limit",
                  "value": "20",
                  "description": "Number of items (max 100)"
                }
              ],
              "variable": [
                {
                  "key": "id",
                  "value": "{{user_id}}",
                  "description": "User ID"
                }
              ]
            },
            "description": "Get paginated list of users that this user follows"
          }
        }
      ],
      "description": "User profile and social graph endpoints"
    },
    {
      "name": "Posts",
      "item": [
        {
          "name": "Create Post (Text Only)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"text\": \"This is my first post! ðŸš€\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/posts",
              "host": ["{{base_url}}"],
              "path": ["posts"]
            },
            "description": "Create a text-only post (authentication required)"
          }
        },
        {
          "name": "Create Post (With Media)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"text\": \"Check out this amazing photo!\",\n  \"mediaUrl\": \"https://your-supabase-project.supabase.co/storage/v1/object/public/media/...\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/posts",
              "host": ["{{base_url}}"],
              "path": ["posts"]
            },
            "description": "Create a post with media URL (get URL from upload endpoint first)"
          }
        },
        {
          "name": "Get Post",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/posts/:id",
              "host": ["{{base_url}}"],
              "path": ["posts", ":id"],
              "variable": [
                {
                  "key": "id",
                  "value": "",
                  "description": "Post ID"
                }
              ]
            },
            "description": "Get a single post by ID"
          }
        },
        {
          "name": "Get User Posts",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/users/:id/posts?offset=0&limit=20",
              "host": ["{{base_url}}"],
              "path": ["users", ":id", "posts"],
              "query": [
                {
                  "key": "offset",
                  "value": "0"
                },
                {
                  "key": "limit",
                  "value": "20"
                }
              ],
              "variable": [
                {
                  "key": "id",
                  "value": "{{user_id}}",
                  "description": "User ID"
                }
              ]
            },
            "description": "Get paginated list of posts by a specific user"
          }
        },
        {
          "name": "Get Personalized Feed",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/feed?offset=0&limit=20",
              "host": ["{{base_url}}"],
              "path": ["feed"],
              "query": [
                {
                  "key": "offset",
                  "value": "0",
                  "description": "Pagination offset"
                },
                {
                  "key": "limit",
                  "value": "20",
                  "description": "Number of posts (max 100)"
                }
              ]
            },
            "description": "Get personalized feed (your posts + posts from users you follow)"
          }
        },
        {
          "name": "Get Upload URL",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    pm.collectionVariables.set('upload_url', response.data.uploadUrl);",
                  "    pm.collectionVariables.set('media_url', response.data.mediaUrl);",
                  "    console.log('âœ… Upload URL saved to collection variable');",
                  "    console.log('ðŸ“¤ Next: Use \"Upload File to Supabase\" request');",
                  "    console.log('Upload URL:', response.data.uploadUrl);",
                  "    console.log('Media URL:', response.data.mediaUrl);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{access_token}}"
              }
            ],
            "url": {
              "raw": "{{base_url}}/posts/upload-url?ext=jpg",
              "host": ["{{base_url}}"],
              "path": ["posts", "upload-url"],
              "query": [
                {
                  "key": "ext",
                  "value": "jpg",
                  "description": "File extension: png, jpg, jpeg, gif, or mp4"
                }
              ]
            },
            "description": "STEP 1: Get signed upload URL from backend. The uploadUrl is automatically saved to collection variables for the next step."
          }
        },
        {
          "name": "Upload File to Supabase",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "image/jpeg",
                "description": "Change based on file type: image/png, image/gif, video/mp4"
              },
              {
                "key": "x-upsert",
                "value": "false"
              }
            ],
            "body": {
              "mode": "file",
              "file": {
                "src": ""
              }
            },
            "url": {
              "raw": "{{upload_url}}",
              "host": ["{{upload_url}}"]
            },
            "description": "STEP 2: Upload your actual file to Supabase Storage.\n\n1. In Body tab, select 'Binary'\n2. Click 'Select File' and choose an image\n3. Send request\n4. You should get 200 OK\n\nThe uploadUrl is automatically populated from the previous request."
          }
        }
      ],
      "description": "Post creation, retrieval, and feed endpoints"
    },
    {
      "name": "Health Check",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "http://localhost:4000/healthz",
          "protocol": "http",
          "host": ["localhost"],
          "port": "4000",
          "path": ["healthz"]
        },
        "description": "Check if the server is running"
      }
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [""]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [""]
      }
    }
  ]
}
